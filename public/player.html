<!DOCTYPE html>
<html>
<head><title>Player</title></head>
<body>
  <input id="code" placeholder="Enter Game Code">
  <input id="name" placeholder="Your Name">
  <button onclick="join()">Join Game</button>

  <div id="actions" style="display:none;">
    <button onclick="sendAction('fold')">Fold</button>
    <button onclick="sendAction('check')">Check</button>
    <button onclick="sendAction('bet')">Bet</button>
  </div>

  <div id="handBox" style="margin-top:20px; display:none;">
    <h3>Your Hand:</h3>
    <div id="handDisplay" style="font-size: 24px;"></div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
    <script>
    const socket = io();

    //autofill code from URL query
    const urlParams = new URLSearchParams(window.location.search);
    const gameCodeFromUrl = urlParams.get('code');
    if (gameCodeFromUrl) {
        document.getElementById("code").value = gameCodeFromUrl.toUpperCase();
    }

    function join() {
      const code = document.getElementById("code").value.toUpperCase();
      const name = document.getElementById("name").value.trim(); // trim removes whitespace

      if (name) {
        socket.emit("join_game", code, name, (response) => {
          if (response.success) {
            document.getElementById("actions").style.display = "block";
          } else {
            alert(response.message);
          }
        });
      } else {
        alert("Name cannot be empty.");
      }
    }

    socket.on("your_hand", (hand) => {
      const display = document.getElementById("handDisplay");
      document.getElementById("handBox").style.display = "block";
      display.textContent = hand.join("  ");
    });

    socket.on("turn_update", (activeId) => {
      const isMyTurn = socket.id === activeId;
      document.getElementById("actions").style.display = isMyTurn ? "block" : "none";
    });


    function sendAction(action) {
        const code = document.getElementById("code").value.toUpperCase();
        socket.emit("player_action", { code, action });
    }
    </script>

</body>
</html>